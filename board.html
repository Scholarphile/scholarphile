<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sticky Board • Scholarphile</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0a;
      --panel: #141414;
      --fg: #ffffff;
      --muted: #8a8a8a;
      --accent: #4ecdc4;
      --border: #242424;
      --shadow: 0 8px 30px rgba(0,0,0,0.35);
      --note-yellow: #fff3b0;
      --note-pink: #ffd6e7;
      --note-blue: #cfe8ff;
      --note-green: #d7fbe8;
      --note-lilac: #e8d7ff;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Open Sans', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg) 0%, #1a1a1a 100%);
      color: var(--fg);
      display: flex;
      flex-direction: column;
    }
    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(10,10,10,0.6);
      backdrop-filter: saturate(140%) blur(8px);
    }
    .brand { font-weight: 700; letter-spacing: 0.2px; }
    .spacer { flex: 1; }
    .btn {
      background: var(--panel);
      color: var(--fg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
    }
    .btn:hover { border-color: var(--accent); }
    .palette { display: flex; gap: 8px; align-items: center; }
    .swatch {
      width: 20px; height: 20px; border-radius: 6px; border: 1px solid var(--border);
      cursor: pointer; box-shadow: var(--shadow);
    }
    .status { color: var(--muted); font-size: 0.9rem; }

    .board {
      position: relative;
      flex: 1;
      overflow: hidden;
    }

    .note {
      position: absolute;
      width: 240px;
      min-height: 160px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.1);
      display: flex; flex-direction: column;
      transform: translateZ(0);
    }
    .note-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 10px; cursor: move; user-select: none;
      background: rgba(0,0,0,0.06);
      border-top-left-radius: 12px; border-top-right-radius: 12px;
    }
    .note-title { font-size: 0.9rem; color: #333; }
    .note-actions { display: flex; gap: 6px; }
    .icon-btn {
      background: rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 8px;
      width: 28px; height: 28px;
      display: grid; place-items: center;
      cursor: pointer;
      color: #333;
    }
    .icon-btn:hover { filter: brightness(0.95); }

    .note-content {
      flex: 1;
      padding: 12px;
      outline: none;
      font-size: 0.95rem;
      color: #222;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    /* Mobile tweaks */
    @media (max-width: 640px) {
      .note { width: 200px; min-height: 140px; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Scholarphile • Sticky Board</div>
    <div class="spacer"></div>
    <div class="palette" aria-label="Note colors">
      <div class="swatch" data-color="var(--note-yellow)" style="background: var(--note-yellow)"></div>
      <div class="swatch" data-color="var(--note-pink)" style="background: var(--note-pink)"></div>
      <div class="swatch" data-color="var(--note-blue)" style="background: var(--note-blue)"></div>
      <div class="swatch" data-color="var(--note-green)" style="background: var(--note-green)"></div>
      <div class="swatch" data-color="var(--note-lilac)" style="background: var(--note-lilac)"></div>
    </div>
    <button id="addNote" class="btn" title="Add a new note">+ Add Note</button>
    <div id="status" class="status" aria-live="polite"></div>
  </div>

  <div id="board" class="board" aria-label="Sticky notes board"></div>

  <script>
  (function(){
    const board = document.getElementById('board');
    const addBtn = document.getElementById('addNote');
    const status = document.getElementById('status');
    const swatches = Array.from(document.querySelectorAll('.swatch'));

    const defaultColor = getComputedStyle(document.documentElement).getPropertyValue('--note-yellow').trim();

    let zCounter = 1;
    let activeColor = defaultColor;

    function save(notes){
      localStorage.setItem('sp_notes', JSON.stringify(notes));
      flash('Saved');
    }

    function load(){
      try { return JSON.parse(localStorage.getItem('sp_notes')||'[]'); } catch { return []; }
    }

    function flash(text){
      status.textContent = text;
      clearTimeout(flash._t);
      flash._t = setTimeout(()=> status.textContent = '', 1200);
    }

    function uid(){
      return 'n_' + Math.random().toString(36).slice(2, 9);
    }

    function currentNotes(){
      return Array.from(board.querySelectorAll('.note')).map(n => ({
        id: n.dataset.id,
        x: parseFloat(n.style.left) || 0,
        y: parseFloat(n.style.top) || 0,
        z: parseInt(n.style.zIndex || '1', 10),
        color: n.dataset.color,
        text: n.querySelector('.note-content').innerHTML
      }));
    }

    function createNote({ id = uid(), x = 40, y = 40, z = ++zCounter, color = activeColor, text = '' } = {}){
      const el = document.createElement('section');
      el.className = 'note';
      el.dataset.id = id;
      el.dataset.color = color;
      el.style.background = color;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      el.style.zIndex = String(z);

      el.innerHTML = `
        <header class="note-header" data-drag-handle>
          <div class="note-title">Note</div>
          <div class="note-actions">
            <button class="icon-btn" data-action="duplicate" title="Duplicate">⧉</button>
            <button class="icon-btn" data-action="delete" title="Delete">✕</button>
          </div>
        </header>
        <div class="note-content" contenteditable="true" spellcheck="true" placeholder="Type...">${text}</div>
      `;

      board.appendChild(el);
      enableDrag(el);
      return el;
    }

    function enableDrag(note){
      const handle = note.querySelector('[data-drag-handle]');
      let startX=0, startY=0, noteX=0, noteY=0, dragging=false;

      const onDown = (e)=>{
        dragging = true;
        note.style.zIndex = String(++zCounter);
        const p = getPoint(e);
        startX = p.x; startY = p.y;
        noteX = parseFloat(note.style.left) || 0;
        noteY = parseFloat(note.style.top) || 0;
        window.addEventListener('pointermove', onMove);
        window.addEventListener('pointerup', onUp);
      };
      const onMove = (e)=>{
        if(!dragging) return;
        const p = getPoint(e);
        const dx = p.x - startX; const dy = p.y - startY;
        note.style.left = (noteX + dx) + 'px';
        note.style.top  = (noteY + dy) + 'px';
      };
      const onUp = ()=>{
        dragging = false;
        window.removeEventListener('pointermove', onMove);
        window.removeEventListener('pointerup', onUp);
        save(currentNotes());
      };

      handle.addEventListener('pointerdown', onDown);
    }

    function getPoint(e){
      return { x: e.clientX, y: e.clientY };
    }

    board.addEventListener('click', (e)=>{
      const action = e.target.dataset.action;
      const note = e.target.closest('.note');
      if(!note) return;
      if(action === 'delete'){
        note.remove();
        save(currentNotes());
      }
      if(action === 'duplicate'){
        const rect = note.getBoundingClientRect();
        const clone = createNote({
          x: (parseFloat(note.style.left)||0) + 24,
          y: (parseFloat(note.style.top)||0) + 24,
          color: note.dataset.color,
          text: note.querySelector('.note-content').innerHTML
        });
        save(currentNotes());
      }
    });

    board.addEventListener('input', (e)=>{
      if(e.target.matches('.note-content')){
        // Save on content change (debounced)
        clearTimeout(board._saveT);
        board._saveT = setTimeout(()=> save(currentNotes()), 300);
      }
    });

    addBtn.addEventListener('click', ()=>{
      createNote({ x: 60 + Math.random()*60, y: 80 + Math.random()*60 });
      save(currentNotes());
    });

    swatches.forEach(s => s.addEventListener('click', ()=>{
      activeColor = getComputedStyle(document.documentElement).getPropertyValue(s.dataset.color ? '' : '').trim();
      // dataset has actual color value, so:
      activeColor = s.getAttribute('data-color');
      flash('Color selected');
    }));

    // Double click board to add a note at cursor
    board.addEventListener('dblclick', (e)=>{
      const rect = board.getBoundingClientRect();
      createNote({ x: e.clientX - rect.left - 120, y: e.clientY - rect.top - 20 });
      save(currentNotes());
    });

    // Initialize from localStorage
    const initial = load();
    initial.forEach(n => createNote(n));

    // If empty, seed with one
    if(initial.length === 0){
      createNote({ text: 'Welcome!\n\n- Drag by the top bar\n- Double‑click the board to add a note\n- Use the swatches to pick a color\n- Click ⧉ to duplicate, ✕ to delete' });
      save(currentNotes());
    }
  })();
  </script>
</body>
</html>
